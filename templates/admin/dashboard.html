{% extends "base.html" %}

{% block title %}Admin Dashboard - Cinematch{% endblock %}

{% block content %}
<div class="min-h-screen bg-gradient-to-br from-gray-900 to-black">
    <!-- Admin Navigation -->
    {% include 'admin/nav.html' %}

    <!-- Dashboard Content -->
    <div class="container mx-auto px-4 py-8">
        <h2 class="text-3xl font-bold mb-8">Dashboard Overview</h2>
        
        <!-- Statistics Grid -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
            <!-- Total Users -->
            <div class="bg-gray-800 rounded-lg p-6 transform hover:scale-105 transition">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-400 text-sm">Total Users</p>
                        <p class="text-3xl font-bold">{{ stats.total_users }}</p>
                        <p class="text-sm text-green-400 mt-2">
                            <i class="fas fa-arrow-up"></i> {{ stats.new_users_today }} today
                        </p>
                    </div>
                    <div class="text-4xl text-blue-500">
                        <i class="fas fa-users"></i>
                    </div>
                </div>
            </div>
            
            <!-- Active Sessions -->
            <div class="bg-gray-800 rounded-lg p-6 transform hover:scale-105 transition">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-400 text-sm">Active Sessions</p>
                        <p class="text-3xl font-bold">{{ stats.active_sessions }}</p>
                        <p class="text-sm text-yellow-400 mt-2">
                            <i class="fas fa-circle"></i> Live now
                        </p>
                    </div>
                    <div class="text-4xl text-green-500">
                        <i class="fas fa-broadcast-tower"></i>
                    </div>
                </div>
            </div>
            
            <!-- Chat Messages -->
            <div class="bg-gray-800 rounded-lg p-6 transform hover:scale-105 transition">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-400 text-sm">Chat Messages</p>
                        <p class="text-3xl font-bold">{{ stats.total_messages }}</p>
                        <p class="text-sm text-blue-400 mt-2">
                            {{ stats.messages_today }} today
                        </p>
                    </div>
                    <div class="text-4xl text-purple-500">
                        <i class="fas fa-comments"></i>
                    </div>
                </div>
            </div>
            
            <!-- API Health -->
            <div class="bg-gray-800 rounded-lg p-6 transform hover:scale-105 transition">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-400 text-sm">API Health</p>
                        <p class="text-3xl font-bold">{{ stats.api_health }}%</p>
                        <p class="text-sm text-green-400 mt-2">
                            <i class="fas fa-check-circle"></i> All systems go
                        </p>
                    </div>
                    <div class="text-4xl text-red-500">
                        <i class="fas fa-heartbeat"></i>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Quick Actions -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
            <!-- Recent Activity -->
            <div class="bg-gray-800 rounded-lg p-6">
                <h3 class="text-xl font-semibold mb-4">Recent Activity</h3>
                <div class="space-y-3">
                    {% for activity in recent_activities %}
                    <div class="flex items-center justify-between py-2 border-b border-gray-700">
                        <div class="flex items-center">
                            <i class="fas fa-{{ activity.icon }} text-{{ activity.color }}-400 mr-3"></i>
                            <div>
                                <p class="text-sm">{{ activity.description }}</p>
                                <p class="text-xs text-gray-500">{{ activity.time_ago }}</p>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                <a href="{{ url_for('admin.activity_log') }}" class="text-blue-400 hover:text-blue-300 text-sm mt-4 inline-block">
                    View all activity â†’
                </a>
            </div>
            
            <!-- Quick Actions -->
            <div class="bg-gray-800 rounded-lg p-6">
                <h3 class="text-xl font-semibold mb-4">Quick Actions</h3>
                <div class="grid grid-cols-2 gap-4">
                    <a href="{{ url_for('admin.api_keys') }}" 
                       class="bg-gray-700 hover:bg-gray-600 p-4 rounded-lg text-center transition">
                        <i class="fas fa-key text-2xl mb-2 text-yellow-400"></i>
                        <p class="text-sm">Manage API Keys</p>
                    </a>
                    
                    <a href="{{ url_for('admin.create_route') }}" 
                       class="bg-gray-700 hover:bg-gray-600 p-4 rounded-lg text-center transition">
                        <i class="fas fa-plus-circle text-2xl mb-2 text-green-400"></i>
                        <p class="text-sm">Create Route</p>
                    </a>
                    
                    <a href="{{ url_for('admin.safety_settings') }}" 
                       class="bg-gray-700 hover:bg-gray-600 p-4 rounded-lg text-center transition">
                        <i class="fas fa-shield-alt text-2xl mb-2 text-blue-400"></i>
                        <p class="text-sm">Safety Settings</p>
                    </a>
                    
                    <a href="{{ url_for('admin.backup') }}" 
                       class="bg-gray-700 hover:bg-gray-600 p-4 rounded-lg text-center transition">
                        <i class="fas fa-download text-2xl mb-2 text-purple-400"></i>
                        <p class="text-sm">Backup Data</p>
                    </a>
                </div>
            </div>
        </div>
        
        <!-- System Status -->
        <div class="bg-gray-800 rounded-lg p-6">
            <h3 class="text-xl font-semibold mb-4">System Status</h3>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <!-- Database Status -->
                <div>
                    <h4 class="font-medium mb-2 text-gray-400">Database</h4>
                    <div class="space-y-2">
                        <div class="flex justify-between">
                            <span class="text-sm">PostgreSQL</span>
                            <span class="text-sm text-green-400">Connected</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-sm">Cache</span>
                            <span class="text-sm text-green-400">Active</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-sm">Vector Store</span>
                            <span class="text-sm text-green-400">{{ stats.vector_count }} vectors</span>
                        </div>
                    </div>
                </div>
                
                <!-- API Status -->
                <div>
                    <h4 class="font-medium mb-2 text-gray-400">APIs</h4>
                    <div class="space-y-2">
                        <div class="flex justify-between">
                            <span class="text-sm">OpenAI</span>
                            <span class="text-sm {% if api_status.openai %}text-green-400{% else %}text-red-400{% endif %}">
                                {% if api_status.openai %}Active{% else %}Not configured{% endif %}
                            </span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-sm">Anthropic</span>
                            <span class="text-sm {% if api_status.anthropic %}text-green-400{% else %}text-red-400{% endif %}">
                                {% if api_status.anthropic %}Active{% else %}Not configured{% endif %}
                            </span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-sm">Google</span>
                            <span class="text-sm {% if api_status.google %}text-green-400{% else %}text-red-400{% endif %}">
                                {% if api_status.google %}Active{% else %}Not configured{% endif %}
                            </span>
                        </div>
                    </div>
                </div>
                
                <!-- Server Info -->
                <div>
                    <h4 class="font-medium mb-2 text-gray-400">Server</h4>
                    <div class="space-y-2">
                        <div class="flex justify-between">
                            <span class="text-sm">CPU Usage</span>
                            <span class="text-sm">{{ server_info.cpu_percent }}%</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-sm">Memory</span>
                            <span class="text-sm">{{ server_info.memory_percent }}%</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-sm">Disk Space</span>
                            <span class="text-sm">{{ server_info.disk_percent }}%</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Add auto-refresh for stats -->
<script>
// Refresh stats every 30 seconds
setInterval(() => {
    fetch('/admin/api/stats')
        .then(response => response.json())
        .then(data => {
            // Update stats dynamically
            console.log('Stats refreshed:', data);
        });
}, 30000);
</script>
{% endblock %}